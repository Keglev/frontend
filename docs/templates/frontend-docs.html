<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>$title$ - StockEase Frontend Docs</title>
  <!-- NOTE: set at runtime to a repo-relative path -->
  <link id="frontend-docs-css" rel="stylesheet" href="">
</head>
<body>
  <header>
    <div class="header-content">
      <!-- Logo/link become repo-relative at runtime -->
      <a id="home-link" href="#" class="logo">ðŸ“š StockEase Frontend Docs</a>
      <nav class="nav-breadcrumb">
        <a id="home-crumb" href="#">Home</a> / <span id="breadcrumb">Documentation</span>
      </nav>
    </div>
  </header>

  <div class="container">
    <aside id="sidebar"></aside>
    <main>
      <div class="content">
        $body$
      </div>
    </main>
  </div>

  <footer>
    <div class="footer-content">
      <p><strong>StockEase</strong> - Inventory Management System</p>
      <p>Architecture Documentation | Generated by Stockease Docs</p>
      <p style="opacity:.7;font-size:.85rem;">Â© 2025 Team StockEase. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Computes relative root from the *docs site root* (public-docs/) for any page.
    function getRootFrom(pathname) {
      // Split and detect position of 'architecture' if present
      const seg = pathname.split('/').filter(Boolean);
      const arch = seg.indexOf('architecture');
      if (arch === -1) return './'; // root pages like /index.html
      // depth: after 'architecture' + filename
      const depth = seg.length - arch - 2;
      if (depth <= 0) return './';
      return '../'.repeat(depth);
    }

    // Set repo-relative CSS + Home links so template works under /<repo>/ subpath
    (function initPaths(){
      const root = getRootFrom(window.location.pathname);
      // CSS lives under ../templates relative to an architecture page,
      // but for root /index.html, it's ./templates.
      // We can always reach it via: root + 'templates/frontend-docs.css'
      document.getElementById('frontend-docs-css').href = root + 'templates/frontend-docs.css';

      const home = root + 'index.html';
      document.getElementById('home-link').href = home;
      document.getElementById('home-crumb').href = home;
    })();

    // Sidebar (frontend-focused). Paths are relative to architecture root by default.
    const navigation = {
      'Frontend Docs': [
        { label: 'Landing', href: '../index.html', isRoot: true },
        { label: 'Architecture Index', href: 'index.html' },
        { label: 'Overview', href: 'overview.html' },
        { label: 'Ãœbersicht (Deutsch)', href: 'overview.de.html' },
        { label: 'Pipeline', href: 'pipeline/overview.html' },
      ],
      'Sections': [
        { label: 'API Layer', href: 'src/api/overview.html' },
        { label: 'Components', href: 'src/components/overview.html' },
        { label: 'Docker Setup', href: 'src/docker_structure/overview.html' },
        { label: 'Localization (i18n)', href: 'src/i18n/overview.html' },
        { label: 'Pages', href: 'src/pages/overview.html' },
        { label: 'Services', href: 'src/services/overview.html' },
        { label: 'Testing', href: 'src/tests/overview.html' },
      ],
      'Generated': [
        { label: 'TypeDoc (TS API)', href: '../frontend/typedoc/index.html', goUp: true },
        { label: 'Coverage (Vitest)', href: '../frontend/coverage/index.html', goUp: true },
      ],
      'Backend (external)': [
        { label: 'Backend Docs', href: 'https://keglev.github.io/stockease/', external: true },
        { label: 'Backend API (ReDoc)', href: 'https://keglev.github.io/stockease/api-docs.html', external: true },
        { label: 'Backend Coverage', href: 'https://keglev.github.io/stockease/coverage/', external: true },
      ],
    };

    function getArchRoot() { return getRootFrom(window.location.pathname); }

    function buildSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) return;
      const archRoot = getArchRoot();
      Object.entries(navigation).forEach(([section, links]) => {
        const wrap = document.createElement('div');
        wrap.className = 'nav-section';
        const title = document.createElement('div');
        title.className = 'nav-section-title';
        title.textContent = section;
        wrap.appendChild(title);
        const ul = document.createElement('ul');

        links.forEach(link => {
          const li = document.createElement('li');
          const a = document.createElement('a');

          if (link.external) {
            a.href = link.href;
          } else if (link.goUp) {
            a.href = archRoot + '../' + link.href.replace('../',''); // ensure ../typedoc/index.html style works
          } else if (link.isRoot) {
            a.href = archRoot + link.href.replace('../',''); // ../index.html from architecture pages
          } else {
            a.href = archRoot + link.href; // within architecture/
          }

          a.textContent = link.label;

          const current = window.location.pathname;
          const linkPath = a.pathname.replace(/\.html$$/,'');
          if (current.endsWith(a.pathname) || current.includes(linkPath)) {
            a.className = 'active';
          }

          li.appendChild(a);
          ul.appendChild(li);
        });

        wrap.appendChild(ul);
        sidebar.appendChild(wrap);
      });
    }

    document.addEventListener('DOMContentLoaded', buildSidebar);
  </script>

  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      securityLevel: 'loose',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
    });

    // Convert fenced code blocks to .mermaid if needed
    const blocks = document.querySelectorAll('code.language-mermaid');
    blocks.forEach(code => {
      code.classList.remove('language-mermaid');
      code.classList.add('mermaid');
      if (code.parentElement.tagName === 'PRE') {
        code.parentElement.classList.add('mermaid-block');
      }
    });

    // Render all mermaid
    (document.readyState === 'loading'
      ? new Promise(r => document.addEventListener('DOMContentLoaded', r))
      : Promise.resolve()
    ).then(() => mermaid.run()).catch(err => console.error('Mermaid rendering error:', err));
  </script>
</body>
</html>
