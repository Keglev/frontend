<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>authorization - StockEase Frontend Docs</title>
  <!-- Will be set to a repo-relative path at runtime -->
  <link rel="stylesheet" href="/frontend/templates/frontend-docs.css">
</head>
<body>
  <header>
    <div class="header-content">
      <a id="home-link" href="#" class="logo">üìö StockEase Frontend Docs</a>
      <nav class="nav-breadcrumb">
        <a id="home-crumb" href="#">Home</a> / <span id="breadcrumb">Documentation</span>
      </nav>
    </div>
  </header>

  <div class="container">
    <aside id="sidebar"></aside>
    <main>
      <div class="content">
        <h1 id="authorization--access-control">Authorization &amp;
        Access Control</h1>
        <h2 id="overview">Overview</h2>
        <p>Authorization determines <strong>what an authenticated user
        can do</strong>. This document explains:</p>
        <ul>
        <li>Role-based access control (RBAC) in StockEase</li>
        <li>How permissions are enforced</li>
        <li>Protecting routes and endpoints</li>
        <li>Error handling and security considerations</li>
        </ul>
        <hr />
        <h2 id="role-based-access-control-rbac">Role-Based Access
        Control (RBAC)</h2>
        <h3 id="roles-in-stockease">Roles in StockEase</h3>
        <p>StockEase implements a two-tier role system:</p>
        <table>
        <thead>
        <tr class="header">
        <th>Role</th>
        <th>Description</th>
        <th>Permissions</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><strong>ROLE_ADMIN</strong></td>
        <td>Administrator</td>
        <td>Full system access, manage users, view all products, system
        settings</td>
        </tr>
        <tr class="even">
        <td><strong>ROLE_USER</strong></td>
        <td>Regular User</td>
        <td>Limited access, view own products, basic operations</td>
        </tr>
        </tbody>
        </table>
        <h3 id="where-roles-come-from">Where Roles Come From</h3>
        <p><strong>1. During Login:</strong></p>
        <div class="sourceCode" id="cb1"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Backend returns JWT with role</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;token&quot;</span><span class="op">:</span> <span class="st">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;role&quot;</span><span class="op">:</span> <span class="st">&quot;ROLE_ADMIN&quot;</span>  <span class="co">// Backend determines this</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
        <p><strong>2. Frontend Extracts Role:</strong></p>
        <div class="sourceCode" id="cb2"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Login service extracts from JWT</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> decodedPayload <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="fu">atob</span>(token<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;.&#39;</span>)[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> role <span class="op">=</span> decodedPayload<span class="op">.</span><span class="at">role</span><span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Store for later use</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;role&#39;</span><span class="op">,</span> role)<span class="op">;</span></span></code></pre></div>
        <p><strong>3. Backend Assigns Role:</strong></p>
        <div class="sourceCode" id="cb3"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backend database stores user role</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">id</span>: <span class="bu">int</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  username: <span class="bu">str</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  email: <span class="bu">str</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  password_hash: <span class="bu">str</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  role: <span class="bu">str</span>  <span class="co"># &quot;ROLE_ADMIN&quot; or &quot;ROLE_USER&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># When issuing token</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>payload <span class="op">=</span> {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;user&#39;</span>: user.username,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;role&#39;</span>: user.role,  <span class="co"># From database</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;exp&#39;</span>: datetime.utcnow() <span class="op">+</span> timedelta(hours<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
        <hr />
        <h2 id="frontend-authorization">Frontend Authorization</h2>
        <h3 id="route-protection">Route Protection</h3>
        <p><strong>Using Protected Routes Component:</strong></p>
        <div class="sourceCode" id="cb4"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In App.tsx</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ProtectedRouteProps {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  element<span class="op">:</span> React<span class="op">.</span><span class="at">ReactElement</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  requiredRole<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> ProtectedRoute<span class="op">:</span> React<span class="op">.</span><span class="at">FC</span><span class="op">&lt;</span>ProtectedRouteProps<span class="op">&gt;</span> <span class="op">=</span> ({</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  element<span class="op">,</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  requiredRole</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>}) <span class="kw">=&gt;</span> {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> token <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> role <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;role&#39;</span>)<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// No token = not authenticated</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>token) {</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&lt;</span>Navigate to<span class="op">=</span><span class="st">&quot;/login&quot;</span> replace <span class="op">/&gt;;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Has required role requirement?</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (requiredRole <span class="op">&amp;&amp;</span> role <span class="op">!==</span> requiredRole) {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">&lt;</span>ErrorPage status<span class="op">=</span>{<span class="dv">403</span>} message<span class="op">=</span><span class="st">&quot;Forbidden&quot;</span> <span class="op">/&gt;;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Authorized, render component</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> element<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Define routes</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> router <span class="op">=</span> <span class="fu">createBrowserRouter</span>([</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  { path<span class="op">:</span> <span class="st">&#39;/login&#39;</span><span class="op">,</span> element<span class="op">:</span> <span class="op">&lt;</span>LoginPage <span class="op">/&gt;</span> }<span class="op">,</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    path<span class="op">:</span> <span class="st">&#39;/user&#39;</span><span class="op">,</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    element<span class="op">:</span> <span class="op">&lt;</span>ProtectedRoute element<span class="op">=</span>{<span class="op">&lt;</span>UserDashboard <span class="op">/&gt;</span>} <span class="op">/&gt;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    path<span class="op">:</span> <span class="st">&#39;/admin&#39;</span><span class="op">,</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    element<span class="op">:</span> <span class="op">&lt;</span>ProtectedRoute </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      element<span class="op">=</span>{<span class="op">&lt;</span>AdminDashboard <span class="op">/&gt;</span>} </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      requiredRole<span class="op">=</span><span class="st">&quot;ROLE_ADMIN&quot;</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">/&gt;</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span></code></pre></div>
        <p><strong>Route Protection Flow:</strong></p>
        <pre><code>User visits /admin
  ‚Üì
ProtectedRoute checks: Do we have token?
  ‚îú‚îÄ No ‚Üí Redirect to /login
  ‚îî‚îÄ Yes ‚Üí Continue
  ‚Üì
ProtectedRoute checks: Do we have required role?
  ‚îú‚îÄ No role required ‚Üí Render component
  ‚îú‚îÄ Role required ‚Üí Check if user has it
    ‚îú‚îÄ Yes ‚Üí Render component
    ‚îî‚îÄ No ‚Üí Show 403 error page</code></pre>
        <h3 id="component-level-authorization">Component-Level
        Authorization</h3>
        <p><strong>Conditionally Render Admin Features:</strong></p>
        <div class="sourceCode" id="cb6"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useAuth } <span class="im">from</span> <span class="st">&#39;@hooks/useAuth&#39;</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> UserDashboard<span class="op">:</span> React<span class="op">.</span><span class="at">FC</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { role<span class="op">,</span> username } <span class="op">=</span> <span class="fu">useAuth</span>()<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>h1<span class="op">&gt;</span>Welcome {username}<span class="op">&lt;/</span>h1<span class="op">&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      {<span class="co">/* All users see this */</span>}</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>ProductList <span class="op">/&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      {<span class="co">/* Only admins see this */</span>}</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      {role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span> <span class="op">&amp;&amp;</span> (</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;</span>AdminSection<span class="op">&gt;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>UserManagement <span class="op">/&gt;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>          <span class="op">&lt;</span>SystemSettings <span class="op">/&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">&lt;/</span>AdminSection<span class="op">&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      )}</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
        <h3 id="useauth-hook">useAuth Hook</h3>
        <p><strong>Implementation:</strong></p>
        <div class="sourceCode" id="cb7"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/hooks/useAuth.ts</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { useEffect<span class="op">,</span> useState } <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> AuthContext {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  isAuthenticated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  role<span class="op">:</span> <span class="st">&#39;ROLE_ADMIN&#39;</span> <span class="op">|</span> <span class="st">&#39;ROLE_USER&#39;</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  username<span class="op">:</span> <span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  logout<span class="op">:</span> () <span class="kw">=&gt;</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> useAuth <span class="op">=</span> ()<span class="op">:</span> AuthContext <span class="kw">=&gt;</span> {</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [auth<span class="op">,</span> setAuth] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>AuthContext<span class="op">&gt;</span>({</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    isAuthenticated<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    role<span class="op">:</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    username<span class="op">:</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    logout<span class="op">:</span> () <span class="kw">=&gt;</span> {}</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read from localStorage</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> token <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> role <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;role&#39;</span>)<span class="op">;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> username <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;username&#39;</span>)<span class="op">;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setAuth</span>({</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      isAuthenticated<span class="op">:</span> <span class="op">!!</span>token<span class="op">,</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      role<span class="op">:</span> (role <span class="im">as</span> <span class="dt">any</span>) <span class="op">||</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      username<span class="op">:</span> username <span class="op">||</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      logout<span class="op">:</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;role&#39;</span>)<span class="op">;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;username&#39;</span>)<span class="op">;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="at">href</span> <span class="op">=</span> <span class="st">&#39;/login&#39;</span><span class="op">;</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> auth<span class="op">;</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
        <p><strong>Usage:</strong></p>
        <div class="sourceCode" id="cb8"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { isAuthenticated<span class="op">,</span> role<span class="op">,</span> username<span class="op">,</span> logout } <span class="op">=</span> <span class="fu">useAuth</span>()<span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Check authentication</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>isAuthenticated) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>Navigate to<span class="op">=</span><span class="st">&quot;/login&quot;</span> <span class="op">/&gt;;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Check specific role</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span>) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Show admin features</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Logout</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>button onClick<span class="op">=</span>{logout}<span class="op">&gt;</span>Logout<span class="op">&lt;/</span>button<span class="op">&gt;</span></span></code></pre></div>
        <hr />
        <h2 id="backend-authorization">Backend Authorization</h2>
        <h3 id="endpoint-protection">Endpoint Protection</h3>
        <p><strong>Backend must verify authorization on every
        request:</strong></p>
        <div class="sourceCode" id="cb9"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> wraps</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> request, jsonify</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> require_role(required_role):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decorator(f):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">@wraps</span>(f)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> decorated_function(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get Authorization header</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            auth_header <span class="op">=</span> request.headers.get(<span class="st">&#39;Authorization&#39;</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> auth_header:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Missing Authorization header&#39;</span>}), <span class="dv">401</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Extract token</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                token <span class="op">=</span> auth_header.replace(<span class="st">&#39;Bearer &#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Verify signature and decode</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                payload <span class="op">=</span> jwt.decode(token, SECRET_KEY, algorithms<span class="op">=</span>[<span class="st">&#39;HS256&#39;</span>])</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check role</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> payload[<span class="st">&#39;role&#39;</span>] <span class="op">!=</span> required_role:</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Forbidden&#39;</span>}), <span class="dv">403</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Token valid and authorized, call endpoint</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> f(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> jwt.ExpiredSignatureError:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Token expired&#39;</span>}), <span class="dv">401</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> jwt.InvalidSignatureError:</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Invalid token&#39;</span>}), <span class="dv">401</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> decorated_function</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decorator</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage:</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/admin/users&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="at">@require_role</span>(<span class="st">&#39;ROLE_ADMIN&#39;</span>)  <span class="co"># Only admins can access</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_users():</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify(users)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/products&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_products():  <span class="co"># Anyone authenticated can access</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (no @require_role, so token just needs to be valid)</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify(products)</span></code></pre></div>
        <h3 id="permission-levels">Permission Levels</h3>
        <p><strong>Common approach:</strong></p>
        <div class="sourceCode" id="cb10"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Level 0: Public endpoint (no auth required)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/health&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> health_check():</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify({<span class="st">&#39;status&#39;</span>: <span class="st">&#39;ok&#39;</span>})</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Level 1: Authenticated users (any role)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/products&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_products():</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Require valid token</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    token <span class="op">=</span> verify_token(request)  <span class="co"># Raises 401 if invalid</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify(products)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Level 2: Specific role required</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/admin/settings&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="at">@require_role</span>(<span class="st">&#39;ROLE_ADMIN&#39;</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_settings():</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify(settings)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Level 3: Multiple roles allowed</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/reports&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="at">@require_any_role</span>([<span class="st">&#39;ROLE_ADMIN&#39;</span>, <span class="st">&#39;ROLE_MANAGER&#39;</span>])</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_reports():</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify(reports)</span></code></pre></div>
        <hr />
        <h2 id="permission-matrix">Permission Matrix</h2>
        <h3 id="stockease-permissions">StockEase Permissions</h3>
        <pre><code>Endpoint                      ROLE_USER   ROLE_ADMIN
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
GET /api/products             ‚úÖ           ‚úÖ
POST /api/products            ‚úÖ*          ‚úÖ
PUT /api/products/{id}        ‚úÖ*          ‚úÖ
DELETE /api/products/{id}     ‚úÖ*          ‚úÖ
GET /api/admin/users          ‚ùå           ‚úÖ
POST /api/admin/users         ‚ùå           ‚úÖ
PUT /api/admin/users/{id}     ‚ùå           ‚úÖ
DELETE /api/admin/users/{id}  ‚ùå           ‚úÖ
GET /api/admin/logs           ‚ùå           ‚úÖ
POST /api/admin/settings      ‚ùå           ‚úÖ</code></pre>
        <p><strong>Key:</strong></p>
        <ul>
        <li>‚úÖ = Allowed</li>
        <li>‚ùå = Forbidden (403 error)</li>
        <li>‚úÖ* = Allowed but restricted (e.g., can only modify own
        products)</li>
        </ul>
        <h3 id="resource-level-authorization">Resource-Level
        Authorization</h3>
        <p><strong>Users can only modify their own
        products:</strong></p>
        <div class="sourceCode" id="cb12"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/products/&lt;int:product_id&gt;&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;PUT&#39;</span>])</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_product(product_id):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get user from token</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    token <span class="op">=</span> verify_token(request)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    user_id <span class="op">=</span> token[<span class="st">&#39;user_id&#39;</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get product from database</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    product <span class="op">=</span> Product.query.get(product_id)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check ownership (unless admin)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> product.user_id <span class="op">!=</span> user_id <span class="kw">and</span> token[<span class="st">&#39;role&#39;</span>] <span class="op">!=</span> <span class="st">&#39;ROLE_ADMIN&#39;</span>:</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> jsonify({<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Forbidden&#39;</span>}), <span class="dv">403</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># User owns product or is admin, update allowed</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    product.update(request.json)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jsonify(product)</span></code></pre></div>
        <p><strong>Flow:</strong></p>
        <pre><code>User (ID: 5) tries to update product (ID: 123, owner: ID: 5)
  ‚Üì
Backend checks: product.user_id (5) == user_id (5)?
  ‚îú‚îÄ Yes ‚Üí Allow update
  ‚îî‚îÄ No ‚Üí Check is_admin?
    ‚îú‚îÄ Yes ‚Üí Allow update
    ‚îî‚îÄ No ‚Üí Return 403 Forbidden</code></pre>
        <hr />
        <h2 id="error-handling">Error Handling</h2>
        <h3 id="authentication-errors-401">Authentication Errors
        (401)</h3>
        <p><strong>When:</strong> Token is missing, invalid, or
        expired</p>
        <div class="sourceCode" id="cb14"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="dv">401</span><span class="fu">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Unauthorized&quot;</span><span class="fu">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Invalid or expired token&quot;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <p><strong>Causes:</strong></p>
        <ul>
        <li>No Authorization header</li>
        <li>Invalid token signature</li>
        <li>Expired token</li>
        <li>Malformed token</li>
        </ul>
        <p><strong>Frontend response:</strong></p>
        <div class="sourceCode" id="cb15"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// In API response interceptor</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (error<span class="op">.</span><span class="at">response</span><span class="op">?.</span><span class="at">status</span> <span class="op">===</span> <span class="dv">401</span>) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clear session</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;role&#39;</span>)<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Redirect to login</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">navigate</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
        <h3 id="authorization-errors-403">Authorization Errors
        (403)</h3>
        <p><strong>When:</strong> User is authenticated but doesn't have
        required role</p>
        <div class="sourceCode" id="cb16"><pre
        class="sourceCode json"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;status&quot;</span><span class="fu">:</span> <span class="dv">403</span><span class="fu">,</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;error&quot;</span><span class="fu">:</span> <span class="st">&quot;Forbidden&quot;</span><span class="fu">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Insufficient privileges&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
        <p><strong>Causes:</strong></p>
        <ul>
        <li>User role doesn't match endpoint requirement</li>
        <li>User trying to access admin feature</li>
        <li>User trying to modify another user's resource</li>
        </ul>
        <p><strong>Frontend response:</strong></p>
        <div class="sourceCode" id="cb17"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Show error to user</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (error<span class="op">.</span><span class="at">response</span><span class="op">?.</span><span class="at">status</span> <span class="op">===</span> <span class="dv">403</span>) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setError</span>(<span class="st">&#39;You do not have permission to access this resource&#39;</span>)<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">// In ProtectedRoute</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (requiredRole <span class="op">&amp;&amp;</span> role <span class="op">!==</span> requiredRole) {</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">&lt;</span>ErrorPage status<span class="op">=</span>{<span class="dv">403</span>} message<span class="op">=</span><span class="st">&quot;Forbidden&quot;</span> <span class="op">/&gt;;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
        <hr />
        <h2 id="common-patterns">Common Patterns</h2>
        <h3 id="pattern-1-owner-or-admin">Pattern 1: Owner or Admin</h3>
        <p><strong>Allow if user owns resource OR is admin:</strong></p>
        <div class="sourceCode" id="cb18"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> canModifyProduct <span class="op">=</span> (</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  product<span class="op">:</span> Product<span class="op">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  currentUserId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  userRole<span class="op">:</span> <span class="dt">string</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>)<span class="op">:</span> <span class="dt">boolean</span> <span class="kw">=&gt;</span> {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Owner can modify</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (product<span class="op">.</span><span class="at">userId</span> <span class="op">===</span> currentUserId) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Admin can modify</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (userRole <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span>) {</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Otherwise, cannot modify</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
        <p><strong>Usage:</strong></p>
        <div class="sourceCode" id="cb19"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">canModifyProduct</span>(product<span class="op">,</span> currentUserId<span class="op">,</span> userRole)) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Show edit button</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>button onClick<span class="op">=</span>{editProduct}<span class="op">&gt;</span>Edit<span class="op">&lt;/</span>button<span class="op">&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hide edit button</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
        <h3 id="pattern-2-role-based-feature-flags">Pattern 2:
        Role-Based Feature Flags</h3>
        <p><strong>Show features based on role:</strong></p>
        <div class="sourceCode" id="cb20"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> features <span class="op">=</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  canViewReports<span class="op">:</span> role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span><span class="op">,</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  canManageUsers<span class="op">:</span> role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span><span class="op">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  canDeleteProducts<span class="op">:</span> role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  canViewProductStats<span class="op">:</span> role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span> <span class="op">||</span> role <span class="op">===</span> <span class="st">&#39;ROLE_USER&#39;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>{features<span class="op">.</span><span class="at">canViewReports</span> <span class="op">&amp;&amp;</span> <span class="op">&lt;</span>ReportsSection <span class="op">/&gt;</span>}</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>{features<span class="op">.</span><span class="at">canManageUsers</span> <span class="op">&amp;&amp;</span> <span class="op">&lt;</span>UserManagement <span class="op">/&gt;</span>}</span></code></pre></div>
        <h3 id="pattern-3-conditional-api-calls">Pattern 3: Conditional
        API Calls</h3>
        <p><strong>Only make API call if authorized:</strong></p>
        <div class="sourceCode" id="cb21"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> fetchAdminData <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> role <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;role&#39;</span>)<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (role <span class="op">!==</span> <span class="st">&#39;ROLE_ADMIN&#39;</span>) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setError</span>(<span class="st">&#39;Not authorized&#39;</span>)<span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> apiClient<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/admin/data&#39;</span>)<span class="op">;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setData</span>(data)<span class="op">;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handle 403 Forbidden</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
        <hr />
        <h2 id="security-best-practices">Security Best Practices</h2>
        <h3 id="-do">‚úÖ DO:</h3>
        <ul>
        <li>‚úÖ Always verify token on backend</li>
        <li>‚úÖ Always check role on backend</li>
        <li>‚úÖ Check ownership of resources</li>
        <li>‚úÖ Log authorization failures</li>
        <li>‚úÖ Use clear role names</li>
        <li>‚úÖ Fail securely (default to deny)</li>
        <li>‚úÖ Validate on both frontend and backend</li>
        <li>‚úÖ Clear token on logout</li>
        </ul>
        <h3 id="-dont">‚ùå DON'T:</h3>
        <ul>
        <li>‚ùå Rely only on frontend authorization</li>
        <li>‚ùå Trust client-provided role information</li>
        <li>‚ùå Skip authorization checks</li>
        <li>‚ùå Use vague permission names</li>
        <li>‚ùå Fail open (default to allow)</li>
        <li>‚ùå Store passwords with roles</li>
        <li>‚ùå Change role in localStorage</li>
        <li>‚ùå Share tokens between users</li>
        </ul>
        <h3 id="additional-safeguards">Additional Safeguards</h3>
        <p><strong>1. Don't Trust Frontend Authorization:</strong></p>
        <div class="sourceCode" id="cb22"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ‚ùå WRONG: Trust frontend</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> role <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;role&#39;</span>)<span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (role <span class="op">===</span> <span class="st">&#39;ROLE_ADMIN&#39;</span>) {</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This could be faked!</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">// ‚úÖ CORRECT: Backend verifies</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> apiClient<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/api/admin/users&#39;</span>)<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Backend checks token and role</span></span></code></pre></div>
        <p><strong>2. Implement Rate Limiting:</strong></p>
        <div class="sourceCode" id="cb23"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backend: Limit API calls per user</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask_limiter <span class="im">import</span> Limiter</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>limiter <span class="op">=</span> Limiter(app, key_func<span class="op">=</span><span class="kw">lambda</span>: get_current_user_id())</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/products&#39;</span>, methods<span class="op">=</span>[<span class="st">&#39;GET&#39;</span>])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="at">@limiter.limit</span>(<span class="st">&#39;100 per hour&#39;</span>)  <span class="co"># Max 100 requests per hour</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_products():</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> products</span></code></pre></div>
        <p><strong>3. Audit Authorization Failures:</strong></p>
        <div class="sourceCode" id="cb24"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backend: Log failed authorization attempts</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_auth_failure(user_id, endpoint, reason):</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    AuthLog.create(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>        user_id<span class="op">=</span>user_id,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        endpoint<span class="op">=</span>endpoint,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        reason<span class="op">=</span>reason,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        timestamp<span class="op">=</span>datetime.utcnow()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">&#39;/api/admin/users&#39;</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> admin_endpoint():</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> role <span class="op">!=</span> <span class="st">&#39;ROLE_ADMIN&#39;</span>:</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        log_auth_failure(user_id, <span class="st">&#39;/api/admin/users&#39;</span>, <span class="st">&#39;insufficient_privileges&#39;</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;error&#39;</span>: <span class="st">&#39;Forbidden&#39;</span>}, <span class="dv">403</span></span></code></pre></div>
        <hr />
        <h2 id="testing-authorization">Testing Authorization</h2>
        <h3 id="frontend-tests">Frontend Tests</h3>
        <div class="sourceCode" id="cb25"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Test protected route redirects unauthorized users</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">&#39;ProtectedRoute&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;redirects to login if no token&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">removeItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>(<span class="op">&lt;</span>ProtectedRoute element<span class="op">=</span>{<span class="op">&lt;</span>AdminPage <span class="op">/&gt;</span>} <span class="op">/&gt;</span>)<span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(<span class="bu">screen</span><span class="op">.</span><span class="fu">getByText</span>(<span class="st">&#39;redirected to&#39;</span>))<span class="op">.</span><span class="fu">toHaveTextContent</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">it</span>(<span class="st">&#39;shows forbidden if role not matching&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;token&#39;</span><span class="op">,</span> <span class="st">&#39;valid-token&#39;</span>)<span class="op">;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    localStorage<span class="op">.</span><span class="fu">setItem</span>(<span class="st">&#39;role&#39;</span><span class="op">,</span> <span class="st">&#39;ROLE_USER&#39;</span>)<span class="op">;</span>  <span class="co">// Not admin</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>(</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>ProtectedRoute </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        element<span class="op">=</span>{<span class="op">&lt;</span>AdminPage <span class="op">/&gt;</span>} </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        requiredRole<span class="op">=</span><span class="st">&quot;ROLE_ADMIN&quot;</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      <span class="op">/&gt;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(<span class="bu">screen</span><span class="op">.</span><span class="fu">getByText</span>(<span class="st">&#39;Forbidden&#39;</span>))<span class="op">.</span><span class="fu">toBeInTheDocument</span>()<span class="op">;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
        <h3 id="backend-tests">Backend Tests</h3>
        <div class="sourceCode" id="cb26"><pre
        class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test endpoint authorization</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_admin_endpoint_requires_admin_role():</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># User token</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    user_token <span class="op">=</span> create_token(role<span class="op">=</span><span class="st">&#39;ROLE_USER&#39;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> client.get(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;/api/admin/users&#39;</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">=</span>{<span class="st">&#39;Authorization&#39;</span>: <span class="ss">f&#39;Bearer </span><span class="sc">{</span>user_token<span class="sc">}</span><span class="ss">&#39;</span>}</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> response.status_code <span class="op">==</span> <span class="dv">403</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">&#39;Forbidden&#39;</span> <span class="kw">in</span> response.json[<span class="st">&#39;error&#39;</span>]</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_admin_endpoint_allows_admin():</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Admin token</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    admin_token <span class="op">=</span> create_token(role<span class="op">=</span><span class="st">&#39;ROLE_ADMIN&#39;</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> client.get(</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;/api/admin/users&#39;</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">=</span>{<span class="st">&#39;Authorization&#39;</span>: <span class="ss">f&#39;Bearer </span><span class="sc">{</span>admin_token<span class="sc">}</span><span class="ss">&#39;</span>}</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> response.status_code <span class="op">==</span> <span class="dv">200</span></span></code></pre></div>
        <hr />
        <h2 id="troubleshooting">Troubleshooting</h2>
        <h3 id="issue-user-sees-403-forbidden-on-admin-page">Issue: User
        sees 403 Forbidden on Admin Page</h3>
        <p><strong>Possible causes:</strong></p>
        <ol type="1">
        <li>User role is not 'ROLE_ADMIN'</li>
        <li>Token doesn't contain role claim</li>
        <li>Backend doesn't recognize role</li>
        </ol>
        <p><strong>Solution:</strong></p>
        <div class="sourceCode" id="cb27"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Check what role is stored</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Stored role:&#39;</span><span class="op">,</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;role&#39;</span>))<span class="op">;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Check JWT token contents</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> token <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> decoded <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="fu">atob</span>(token<span class="op">.</span><span class="fu">split</span>(<span class="st">&#39;.&#39;</span>)[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Token role:&#39;</span><span class="op">,</span> decoded<span class="op">.</span><span class="at">role</span>)<span class="op">;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">// They should match</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">// If not, the issue is during login</span></span></code></pre></div>
        <h3 id="issue-admin-cant-access-protected-endpoint">Issue: Admin
        can't access protected endpoint</h3>
        <p><strong>Possible causes:</strong></p>
        <ol type="1">
        <li>Token not being sent in request</li>
        <li>Authorization header malformed</li>
        <li>Backend not recognizing token</li>
        </ol>
        <p><strong>Solution:</strong></p>
        <div class="sourceCode" id="cb28"><pre
        class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if Authorization header is being sent</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>apiClient<span class="op">.</span><span class="at">interceptors</span><span class="op">.</span><span class="at">request</span><span class="op">.</span><span class="fu">use</span>((config) <span class="kw">=&gt;</span> {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> token <span class="op">=</span> localStorage<span class="op">.</span><span class="fu">getItem</span>(<span class="st">&#39;token&#39;</span>)<span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (token) {</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    config<span class="op">.</span><span class="at">headers</span><span class="op">.</span><span class="at">Authorization</span> <span class="op">=</span> <span class="vs">`Bearer </span><span class="sc">${</span>token<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Sending token:&#39;</span><span class="op">,</span> token<span class="op">.</span><span class="fu">substring</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">20</span>) <span class="op">+</span> <span class="st">&#39;...&#39;</span>)<span class="op">;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> config<span class="op">;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Check network tab in DevTools</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Look for Authorization: Bearer ... header</span></span></code></pre></div>
        <hr />
        <h2 id="related-files">Related Files</h2>
        <ul>
        <li><strong>Protected Routes:</strong>
        <code>src/App.tsx</code></li>
        <li><strong>Auth Hook:</strong>
        <code>src/hooks/useAuth.ts</code></li>
        <li><strong>Login Page:</strong>
        <code>src/pages/LoginPage.tsx</code></li>
        <li><strong>Admin Dashboard:</strong>
        <code>src/pages/AdminDashboard.tsx</code></li>
        <li><strong>API Client:</strong>
        <code>src/services/apiClient.ts</code></li>
        <li><strong>Auth Service:</strong>
        <code>src/api/auth.ts</code></li>
        </ul>
        <hr />
        <p><strong>Last Updated:</strong> November 13, 2025<br />
        <strong>Status:</strong> Production-Ready</p>
      </div>
    </main>
  </div>

  <footer>
    <div class="footer-content">
      <p><strong>StockEase</strong> - Inventory Management System</p>
      <p>Architecture Documentation | Frontend</p>
      <p style="opacity:.7;font-size:.85rem;">¬© 2025 Team StockEase. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Absolute base for the site on GitHub Pages
    const BASE = '/frontend/';

    // Sidebar (frontend-focused). Keep hrefs relative to 'architecture/' except where absolute noted.
    const navigation = {
      'Frontend Docs': [
        { label: 'Landing', href: 'index.html', isRoot: true },
        { label: 'Architecture Index', href: 'index.html' },
        { label: 'Overview', href: 'overview.html' },
        { label: '√úbersicht (Deutsch)', href: 'overview.de.html' },
        { label: 'Docs Pipeline', href: 'docs-pipeline/overview.html' },
        { label: 'Production Pipeline', href: 'pipeline/overview.html' },
      ],
      'Sections': [
        { label: 'API Layer', href: 'src/api/overview.html' },
        { label: 'Components', href: 'src/components/overview.html' },
        { label: 'Security', href: 'src/security/overview.html' },
        { label: 'Pages', href: 'src/pages/overview.html' },
        { label: 'Services', href: 'src/services/overview.html' },
        { label: 'Localization (i18n)', href: 'src/i18n/overview.html' },
        { label: 'Docker Setup', href: 'src/docker_structure/overview.html' },
        { label: 'Testing', href: 'src/tests/overview.html' },
      ],
      'Generated': [
        // Use absolute internal paths so they always resolve with CSS
        { label: 'TypeDoc (TS API)', href: '/frontend/typedoc/index.html', absolute: true },
        { label: 'Coverage (Vitest)', href: '/frontend/coverage/index.html', absolute: true },
      ],
      'Backend (external)': [
        { label: 'Backend Docs', href: 'https://keglev.github.io/stockease/', external: true },
        { label: 'Backend API (ReDoc)', href: 'https://keglev.github.io/stockease/api-docs.html', external: true },
        { label: 'Backend Coverage', href: 'https://keglev.github.io/stockease/coverage/', external: true },
      ],
    };

    // Set header links to the site root
    document.addEventListener('DOMContentLoaded', () => {
      const home = BASE + 'index.html';
      const homeLink = document.getElementById('home-link');
      const homeCrumb = document.getElementById('home-crumb');
      if (homeLink) homeLink.href = home;
      if (homeCrumb) homeCrumb.href = home;
    });

    function buildSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) return;

      Object.entries(navigation).forEach(([section, links]) => {
        const block = document.createElement('div');
        block.className = 'nav-section';

        const title = document.createElement('div');
        title.className = 'nav-section-title';
        title.textContent = section;
        block.appendChild(title);

        const ul = document.createElement('ul');
        links.forEach(link => {
          const li = document.createElement('li');
          const a = document.createElement('a');

          if (link.external || link.absolute) {
            // external http(s) OR absolute internal '/frontend/...'
            a.href = link.href;
          } else if (link.isRoot) {
            a.href = BASE + 'index.html';
          } else if (link.isCoverage) {
            a.href = BASE + 'coverage/index.html';
          } else if (link.isApiDoc) {
            a.href = BASE + 'api-docs.html';
          } else {
            // default: architecture-relative
            a.href = BASE + 'architecture/' + link.href;
          }

          a.textContent = link.label;

          // Active-state highlight
          const current = window.location.pathname;
          const linkPath = a.pathname.replace(/\.html$/, '');
          if (current.endsWith(a.pathname) || current.includes(linkPath)) {
            a.className = 'active';
          }

          li.appendChild(a);
          ul.appendChild(li);
        });

        block.appendChild(ul);
        sidebar.appendChild(block);
      });
    }

    document.addEventListener('DOMContentLoaded', buildSidebar);
  </script>

  <!-- Mermaid.js for diagrams -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: false,
      theme: 'default',
      securityLevel: 'loose',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',
    });

    // Convert fenced code blocks emitted by Pandoc to <div class="mermaid"> sources
    const blocks = document.querySelectorAll('code.language-mermaid');
    blocks.forEach(code => {
      code.classList.remove('language-mermaid');
      code.classList.add('mermaid');
      if (code.parentElement.tagName === 'PRE') {
        code.parentElement.classList.add('mermaid-block');
      }
    });

    // Render all diagrams
    (document.readyState === 'loading'
      ? new Promise(r => document.addEventListener('DOMContentLoaded', r))
      : Promise.resolve()
    ).then(() => mermaid.run()).catch(err => console.error('Mermaid rendering error:', err));
  </script>
</body>
</html>
